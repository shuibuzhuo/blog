å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å“ˆé»˜ã€‚ä»Šå¤©æˆ‘ä»¬æ¥ç®€å•è¯´ä¸€ä¸‹å‰ç«¯æ¨¡å—åŒ–çš„å‘å±•ã€‚

## èƒŒæ™¯

æˆ‘ä»¬çš„é¡µé¢æ˜¯ç”± html, css, js ç»„æˆçš„ï¼Œæˆ‘ä»¬å°†é€»è¾‘æ”¾åˆ°äº† js é‡Œç¼–å†™ã€‚éšç€é€»è¾‘è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šå¤æ‚ï¼Œjs æ–‡ä»¶ä¹Ÿä¼šè¶Šæ¥è¶Šé•¿ï¼Œå¹¶éš¾ä»¥é˜…è¯»ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†ä¸åŒçš„é€»è¾‘æ‹†åˆ†åˆ°ä¸åŒçš„æ¨¡å—ã€‚

- ä¸€ä¸ªæ¨¡å—åŒ…å«è¾“å…¥å’Œè¾“å‡º
- æ¨¡å—å†…éƒ¨çš„å®žçŽ°æ˜¯ç§æœ‰çš„ï¼Œå¯¹å¤–æš´éœ²æŽ¥å£ä¸Žå…¶ä»–æ¨¡å—è¿›è¡Œé€šä¿¡

å‰ç«¯æ¨¡å—åŒ–åªæ˜¯ä¸€ç§æ ‡å‡†ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„å®žçŽ°ï¼Œé‚£ä¹ˆå…·ä½“å®žçŽ°æ¨¡å—åŒ–çš„æ–¹å¼ä¹Ÿæ˜¯é€æ­¥è¿›è¡Œæ¼”åŒ–çš„ã€‚

## ä½¿ç”¨å…¨å±€å‡½æ•°

æœ€ç®€å•æœ€ç›´æŽ¥çš„æ–¹å¼ï¼Œå°±æ˜¯å¯ä»¥å°†ä¸åŒé€»è¾‘å°è£…åˆ°ä¸åŒçš„å‡½æ•°ä¸­ã€‚

```js
function request() {
  return {
    code: 200,
    data: {
      scores: [90, 95, 88, 35, 55, 91],
    },
  };
}

function average(scores) {
  const total = scores.reduce(function (res, score) {
    return res + score;
  }, 0);

  return `ä½ çš„å¹³å‡åˆ†æ˜¯${total / scores.length}ã€‚`;
}

function fail(scores) {
  const failScores = scores.filter((score) => score < 60);

  return `å¾ˆæŠ±æ­‰ï¼Œä½ æœ‰${failScores.length}æ¬¡ä¸åˆæ ¼ã€‚`;
}

const scores = request().data.scores;
console.log("average", average(scores));
console.log("fail", fail(scores));
```

è¿™ç§æ–¹å¼çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜Žæ˜¾ï¼Œæˆ‘ä»¬å®šä¹‰çš„ `requestã€averageã€fail` å‡½æ•°ï¼Œéƒ½æ˜¯å®šä¹‰åœ¨ window å¯¹è±¡ä¸Šçš„ï¼Œå¦‚æžœæˆ‘ä»¬å¼•å…¥äº†ç¬¬ä¸‰æ–¹æˆ–è€…å…¶ä»–å°ä¼™ä¼´çš„ jsï¼Œé‚£ä¹ˆå¾ˆéš¾ä¿è¯ä»–ä»¬æ²¡æœ‰ä¹ŸåŽ»å®šä¹‰åŒåçš„å‡½æ•°ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬çš„å‡½æ•°åå–çš„æ¯”è¾ƒé€šç”¨çš„æ—¶å€™ï¼Œæ¯”å¦‚ `add`ã€‚

æ‰€ä»¥ï¼Œå…¨å±€å‡½æ•°çš„æ–¹å¼å®¹æ˜“å¼•å‘å‘½åå†²çªã€‚

## ä½¿ç”¨å…¨å±€ namespace

è¦è§£å†³ `å…¨å±€å‡½æ•°` çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å‡½æ•°çš„å®šä¹‰æ”¾å…¥ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œæ¯”å¦‚ `__module__`ï¼š

```js
var __module__ = {
  request() {
    return {
      code: 200,
      data: {
        scores: [90, 95, 88, 35, 55, 91],
      },
    };
  },
  average(scores) {
    const total = scores.reduce(function (res, score) {
      return res + score;
    }, 0);

    return `ä½ çš„å¹³å‡åˆ†æ˜¯${total / scores.length}ã€‚`;
  },
  fail(scores) {
    const failScores = scores.filter((score) => score < 60);

    return `å¾ˆæŠ±æ­‰ï¼Œä½ æœ‰${failScores.length}æ¬¡ä¸åˆæ ¼ã€‚`;
  },
};

var m = window.__module__;
const scores = m.request().data.scores;
console.log("average", m.average(scores));
console.log("fail", m.fail(scores));
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬é¿å…äº†ç›´æŽ¥å°† `requestã€averageã€fail` å®šä¹‰åœ¨ window å¯¹è±¡ä¸Šï¼Œè€Œæ˜¯å®šä¹‰åœ¨ `__module__` ä¸Šï¼Œè€Œ `__module__` çš„åå­—ï¼Œä¸€èˆ¬ä¹Ÿå¾ˆéš¾ä¸Žå…¶ä»–äººå†²çªï¼Œå¦‚æžœæˆ‘ä»¬å–çš„åå­—åœ¨é•¿ä¸€äº›çš„è¯ã€‚ã€‚ã€‚

ä½†è¿™ç§æ–¹å¼çš„é—®é¢˜å°±æ˜¯ï¼šå¤–éƒ¨å¯ä»¥éšæ„ä¿®æ”¹ `__module__` å†…éƒ¨çš„æ•°æ®:

```js
var __module__ = {
  num: 100,
  request() { ... },
  average(scores) { ... },
  fail(scores) { ... },
};

var m = window.__module__;

m.num = 200; // å¯ä»¥éšæ„ä¿®æ”¹æ¨¡å—å†…éƒ¨çš„æ•°æ®ðŸ¤

```

è¿™è¿åäº†æˆ‘ä»¬ä¹‹å‰å¯¹äºŽæ¨¡å—çš„å®šä¹‰ï¼š

> æ¨¡å—å†…éƒ¨çš„å®žçŽ°æ˜¯ç§æœ‰çš„ï¼Œå¯¹å¤–æš´éœ²æŽ¥å£ä¸Žå…¶ä»–æ¨¡å—è¿›è¡Œé€šä¿¡

## ä½¿ç”¨ iife

è§£å†³ `namespace` æ–¹æ¡ˆçš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ `iife` è‡ªæ‰§è¡Œå‡½æ•°æ¥åˆ›å»ºé—­åŒ…ï¼š

```js
(function (global) {
  var num = 100;

  function request() {
    return {
      code: 200,
      data: {
        scores: [90, 95, 88, 35, 55, 91],
      },
    };
  }

  function average(scores) {
    const total = scores.reduce(function (res, score) {
      return res + score;
    }, 0);

    return `ä½ çš„å¹³å‡åˆ†æ˜¯${total / scores.length}ã€‚`;
  }

  function fail(scores) {
    const failScores = scores.filter((score) => score < 60);

    return `å¾ˆæŠ±æ­‰ï¼Œä½ æœ‰${failScores.length}æ¬¡ä¸åˆæ ¼ã€‚`;
  }

  function getNum() {
    return num;
  }

  function setNum(newValue) {
    num = newValue;
  }

  global.__module__ = {
    request,
    average,
    fail,
    getNum,
    setNum,
  };
})(window);

const m = window.__module__;
const scores = m.request().data.scores;
console.log("average", m.average(scores));
console.log("fail", m.fail(scores));
```

çŽ°åœ¨æˆ‘ä»¬æ— æ³•ç›´æŽ¥è®¿é—® num å˜é‡äº†ï¼Œåªèƒ½é€šè¿‡æ¨¡å—å†…éƒ¨æä¾›çš„ getNumã€setNum æ¥å¯¹ num è¿›è¡Œæ“ä½œ:

```js
console.log(m.getNum());
m.setNum(200);
console.log(m.getNum());
```

è¿™ç§æ–¹å¼ï¼Œæ˜¯æ¯”è¾ƒå®Œç¾Žçš„ï¼Œå®ƒè®©æˆ‘ä»¬çš„æ•°æ®æ›´å®‰å…¨äº†ã€‚

ä½†æ˜¯ï¼Œè¿™ä»…é™äºŽæˆ‘ä»¬åªæœ‰ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ã€‚

å¦‚æžœæˆ‘ä»¬æœ‰å¤šä¸ªæ¨¡å—ï¼Œå¹¶ä¸”æ¨¡å—ä¹‹é—´è¿˜å­˜åœ¨ç€ä¾èµ–ï¼Œæˆ‘ä»¬å¦‚ä½•è®©ä¸€ä¸ªæ¨¡å—åŽ»å¼•ç”¨å¦ä¸€ä¸ªæ¨¡å—å‘¢ï¼Ÿ

## iife + ä¼ å‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸¤ä¸ªæ¨¡å—ã€‚

request æ¨¡å—ï¼š

```js
(function (global) {
  function request() {
    return {
      code: 200,
      data: {
        scores: [90, 95, 88, 35, 55, 91],
      },
    };
  }

  global.__module__ = {
    request,
  };
})(window);
```

handle æ¨¡å—ï¼š

```js
(function (global) {
  function average(scores) {
    const total = scores.reduce(function (res, score) {
      return res + score;
    }, 0);

    return `ä½ çš„å¹³å‡åˆ†æ˜¯${total / scores.length}ã€‚`;
  }

  function fail(scores) {
    const failScores = scores.filter((score) => score < 60);

    return `å¾ˆæŠ±æ­‰ï¼Œä½ æœ‰${failScores.length}æ¬¡ä¸åˆæ ¼ã€‚`;
  }

  global.__module__ = {
    average,
    fail,
  };
})(window);
```

å¾ˆæ˜Žæ˜¾ï¼Œhandle æ¨¡å—æ˜¯éœ€è¦ä¾èµ– request æ¨¡å—çš„æ•°æ®çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `ä¼ å‚` çš„å½¢å¼ï¼Œå°† handle æ¨¡å—ä¼ å…¥ request æ¨¡å—ä¸­ã€‚

request æ¨¡å—æ”¹é€ ä¸€ä¸‹ï¼š

```diff
 (function (global) {
   function request() { ... }

-  global.__module__ = {
-    request,
-  };

+  global.__module_request__ = {
+    request,
+  };
 })(window);
```

handle æ¨¡å—ä¹Ÿç›¸åº”æ”¹é€ ä¸‹ï¼š

```diff
- (function (global) {
+ (function (global, req) {
    function average(scores) { ... }

    function fail(scores) { ... }

    global.__module__ = {
+     req,
      average,
      fail,
    };
- )(window);
+ })(window, window.__module_request__);

+ const m = window.__Module;
+ const scores = m.req.request().data.scores;
+ console.log(m.average(scores));
+ console.log(m.fail(scores));
```

æˆ‘ä»¬åœ¨å®šä¹‰ handle æ¨¡å—çš„æ—¶å€™ï¼Œå°† request æ¨¡å—ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ iife å†…éƒ¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ° request æ¨¡å—é‡Œçš„ request æ–¹æ³•äº†ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±è§£å†³äº†æ¨¡å—ä¹‹é—´ä¾èµ–çš„é—®é¢˜ã€‚

ä½†æ˜¯ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜Žæ˜¾ï¼š

1. å½“æœ‰å¤šä¸ªä¾èµ–çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¹Ÿå°†å˜å¤šï¼Œä»£ç ä¼šè¶Šæ¥è¶Šéš¾ä»¥é˜…è¯»
2. å†™æ³•æ¯”è¾ƒç¹ç

ã€‚ã€‚ã€‚

## CommonJS å’Œ ES Module

åŸºäºŽä»¥ä¸Šçš„çš„æ¼”åŒ–ï¼Œæˆ‘ä»¬æœ‰äº†åŸºæœ¬çš„å®žçŽ°æ¨¡å—åŒ–çš„æ–¹å¼ã€‚

ä¸ºäº†è®©ä¹¦å†™æ¨¡å—åŒ–æ›´æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰äº†å¾ˆå¤šçš„æ¨¡å—åŒ–æ ‡å‡†ï¼ŒçŽ°åœ¨æœ€æµè¡Œçš„å°±æ˜¯ï¼šCommonJS å’Œ ES Moduleã€‚

åœ¨æˆ‘ä»¬ä½¿ç”¨è¿™ä¸¤ç§æ¨¡å—åŒ–æ ‡å‡†ä¹¦å†™æˆ‘ä»¬çš„ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„æ¯ä¸€ä¸ªæ¨¡å—ï¼Œå°±å¯ä»¥å®šä¹‰åœ¨ä¸€ä¸ª js çš„æ–‡ä»¶é‡Œé¢ã€‚

æ¨¡å—çš„å¼•å…¥å’Œå¯¼å‡ºï¼Œå°±å¯ä»¥åˆ†åˆ«ä½¿ç”¨å¯¹åº”çš„è¯­æ³•æ¥è¿›è¡Œï¼š

- CommonJS çš„å¯¼å‡ºï¼šmodule.exports
- CommonJS çš„å¯¼å…¥: require
- ES Module çš„å¯¼å‡ºï¼šexport
- ES Module çš„å¯¼å…¥: import

å¦‚æžœå°†ä¸¤ç§æ ‡å‡†çš„ä»£ç è¿›è¡Œæ‰“åŒ…ï¼Œæœ€ç»ˆçš„ç»“æžœä¹Ÿæ˜¯åŸºäºŽ `iife` æ¥å®žçŽ°çš„ã€‚

CommonJS:

![cjs](./cjs.png)

ES Module:
![esm](./esm.png)

## æ€»ç»“

é€šè¿‡è¿™ç¯‡æ–‡ç« çš„å­¦ä¹ ï¼Œæˆ‘ä»¬åˆæ­¥äº†è§£äº†æ¨¡å—åŒ–çš„ä¸€ä¸ªå‘å±•åŽ†ç¨‹ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¯¹äºŽæ¨¡å—åŒ–æœ‰ä¸€ä¸ªæ›´æ¸…æ™°çš„è®¤è¯† ðŸ˜Š
